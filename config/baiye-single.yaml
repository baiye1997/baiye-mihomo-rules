# åŸºç¡€é”šç‚¹
url:  &url  "http://connectivitycheck.platform.hicloud.com/generate_204"   # å¥åº·æ£€æŸ¥ URL
blk:  &blk '^(?!.*(?i:(å›å›½|æ ¡å›­|ç½‘ç«™|åœ°å€|å‰©ä½™|è¿‡æœŸ|æ—¶é—´|æœ‰æ•ˆ|ç½‘å€|ç¦æ­¢|é‚®ç®±|å‘å¸ƒ|å®¢æœ|è®¢é˜…|èŠ‚ç‚¹|ç¾¤|é‚€è¯·|è¿”åˆ©|å¾ªç¯|è·å–|æµé‡|åˆ°æœŸ|ä¸‹æ¬¡|ç‰ˆæœ¬|å®˜å€|å¤‡ç”¨|å·²ç”¨|è”ç³»|å·¥å•|è´©å–|é€šçŸ¥|å€’å–|å›½å†…|é¢‘é“|è¯´æ˜|æç¤º|ä½œè€…|åŠ å…¥|USE|USED|TOTAL|EXPIRE|EMAIL|Panel|Channel|Author|\d{4}-\d{2}-\d{2}|\d+G))).*$'
prov: &prov {type: http, interval: 86400, health-check: {enable: true, url: *url, interval: 300}}


# ======================= å»ºè®®ä»…ä¿®æ”¹æ­¤éƒ¨åˆ†å†…å®¹======================
# ========================= è®¢é˜… Providers =======================
# "æ›¿æ¢è®¢é˜…é“¾æ¥1"é‡Œå¡«å…¥ä½ çš„æœºåœºè®¢é˜…é“¾æ¥

proxy-providers:
  Node:
    url: "æ›¿æ¢è®¢é˜…é“¾æ¥1"
    <<: *NodeParam
    path: './proxy_provider/providers.yaml'
    filter: *blk

# ======================  â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸  ========================


# ======================= ä»¥ä¸‹å†…å®¹å»ºè®®å°ç™½å‹¿ä¿®æ”¹ =======================
# ========================== åŸºç¡€é…ç½® ==========================
mixed-port: 7897
allow-lan: true
bind-address: '*'
mode: rule
log-level: warning
unified-delay: true
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome

external-controller: 127.0.0.1:9090
# external-ui: ui
# secret: "yourpassword"

keep-alive-idle: 600
keep-alive-interval: 60

skip-auth-prefixes:
  - 127.0.0.0/8
  - 10.0.0.0/8
  - 172.16.0.0/12
  - 192.168.0.0/16
  - 100.64.0.0/10
  - ::1/128
  - fc00::/7
  - fe80::/10

profile:
  store-selected: true
  store-fake-ip: true


# ============================ DNS ============================
dns:
  enable: true
  prefer-h3: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  use-hosts: true

  # å›½é™…ï¼ˆåŠ å¯†é˜²æ±¡æŸ“ï¼‰
  nameserver:
    - "tls://1.1.1.1"
    - "tls://8.8.8.8"
    - "tls://[2606:4700:4700::1111]"
    - "tls://[2001:4860:4860::8888]"

  # å›½å†…ï¼ˆå°±è¿‘ç¨³å®šï¼‰
  default-nameserver:
    - "223.5.5.5"
    - "119.29.29.29"
    - "180.184.1.1"
    - "[2400:3200::1]"
    - "[2402:4e00::]"

  # æŒ‰åœ°åŸŸåˆ†æµè§£æ
  nameserver-policy:
    'geosite:cn':
      - "223.5.5.5"
      - "119.29.29.29"
      - "180.184.1.1"
      - "[2400:3200::1]"
      - "[2402:4e00::]"
    'geosite:geolocation-!cn':
      - "tls://1.1.1.1"
      - "tls://8.8.8.8"
      - "tls://[2606:4700:4700::1111]"
      - "tls://[2001:4860:4860::8888]"

  # èŠ‚ç‚¹åŸŸåè§£æ
  proxy-server-nameserver:
    - "system"
    - "tls://1.1.1.1"
    - "tls://8.8.8.8"
    - "tls://[2606:4700:4700::1111]"
    - "tls://[2001:4860:4860::8888]"

  # fake-ip ï¼ˆruleset å¼•ç”¨ + ä»å¯è¿½åŠ é›¶æ˜ŸåŸŸåï¼‰
  fake-ip-filter:
    - rule-set:fake_ip   #  è§„åˆ™é›†å¼•ç”¨
    # ä¹Ÿå¯ç»§ç»­è¿½åŠ ï¼š
    # - 'example.local'


# ========================== å—…æ¢è®¾ç½® ==========================
sniffer:
  enable: true
  sniff:
    HTTP: {ports: [80, 8080-8880], override-destination: true}
    TLS:  {ports: [443, 8443]}
    QUIC: {ports: [443, 8443]}
  skip-domain:
    - rule-set:sniff_skip   #  è§„åˆ™é›†å¼•ç”¨
    # ä¹Ÿå¯ç»§ç»­è¿½åŠ ï¼š
    # - "+.example.com"


# ============================ TUN ============================
tun:
  enable: true
  stack: mixed
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - any:53
    - tcp://any:53
  strict-route: true
  mtu: 1500


# ========================== Geodata ==========================
geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip:   "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat"
  mmdb:    "https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb"
  asn:     "https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/GeoLite2-ASN.mmdb"


# ============================ é”šç‚¹ ============================
# â€”â€” åŸºç¡€æ¨¡æ¿ â€”â€” #
tmpl: &tmpl {url: *url, interval: 300, lazy: true, timeout: 2000, disable-udp: false, max-failed-times: 3, hidden: true, include-all: true}
sel:  &sel  {type: select, url: *url, disable-udp: false, hidden: false, include-all: true}
test: &test {type: url-test, <<: *tmpl, tolerance: 50}
fall: &fall {type: fallback, <<: *tmpl}

# â€”â€” å…¥å£ / åº”ç”¨æ¨¡æ¿ â€”â€” #
entr: &entr {type: select, proxies: ["â™»ï¸ æ™ºèƒ½é€‰æ‹©","ğŸ‘† æ‰‹åŠ¨é€‰æ‹©","DIRECT"]}
app:  &app  {type: select, proxies: ["ğŸš€ èŠ‚ç‚¹é€‰æ‹©","DIRECT","ğŸ‡­ğŸ‡° - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡¹ğŸ‡¼ - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡¯ğŸ‡µ - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡°ğŸ‡· - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡¸ğŸ‡¬ - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡ºğŸ‡¸ - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡¬ğŸ‡§ - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡«ğŸ‡· - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡©ğŸ‡ª - æ‹©ä¼˜èŠ‚ç‚¹"]}
strm: &strm {type: select, proxies: ["ğŸš€ èŠ‚ç‚¹é€‰æ‹©","DIRECT","ğŸ‡­ğŸ‡° - è‡ªåŠ¨å›é€€","ğŸ‡¹ğŸ‡¼ - è‡ªåŠ¨å›é€€","ğŸ‡¯ğŸ‡µ - è‡ªåŠ¨å›é€€","ğŸ‡°ğŸ‡· - è‡ªåŠ¨å›é€€","ğŸ‡¸ğŸ‡¬ - è‡ªåŠ¨å›é€€","ğŸ‡ºğŸ‡¸ - è‡ªåŠ¨å›é€€","ğŸ‡¬ğŸ‡§ - è‡ªåŠ¨å›é€€","ğŸ‡«ğŸ‡· - è‡ªåŠ¨å›é€€","ğŸ‡©ğŸ‡ª - è‡ªåŠ¨å›é€€"]}

# â€”â€” æ‰‹åŠ¨é€‰æ‹©ï¼ˆåœ¨ sel åŸºç±»ä¸ŠåŠ è¿‡æ»¤ï¼‰ â€”â€” #
manu: &manu {<<: *sel, filter: *blk}

# â€”â€” åœ°åŒºç­›é€‰ â€”â€” #
hk: &hk '(?i)(ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong)'
tw: &tw '(?i)(ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Tai|Taiwan)'
jp: &jp '(?i)(ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan|ä¸œäº¬|å¤§é˜ª|åŸ¼ç‰|æ³‰æ—¥|å·æ—¥)'
kr: &kr '(?i)(ğŸ‡°ğŸ‡·|éŸ©å›½|KR|Korea|é¦–å°”|éŸ“)'
sg: &sg '(?i)(ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|SG|Singapore|ç‹®)'
us: &us '(?i)(ğŸ‡ºğŸ‡¸|ç¾å›½|US|United States|æ´›æ‰çŸ¶|ç¡…è°·|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|æ‹‰æ–¯ç»´åŠ æ–¯|å‡¤å‡°åŸ|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|è´¹åˆ©è’™)'
uk: &uk '(?i)(ğŸ‡¬ğŸ‡§|è‹±å›½|UK|United Kingdom|ä¼¦æ•¦)'
fr: &fr '(?i)(ğŸ‡«ğŸ‡·|æ³•å›½|FR|France)'
de: &de '(?i)(ğŸ‡©ğŸ‡ª|å¾·å›½|DE|Germany)'


# ========================= proxy-groups =========================
proxy-groups:
  # å…¥å£ä¸åŸºç¡€
  - {name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©", <<: *entr, icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/choice.png"}
  - {name: "ğŸ‘† æ‰‹åŠ¨é€‰æ‹©", <<: *manu, icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/select.png"}
  - {name: "â™»ï¸ æ™ºèƒ½é€‰æ‹©", <<: *test, proxies: ["ğŸ‡­ğŸ‡° - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡¹ğŸ‡¼ - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡¯ğŸ‡µ - æ‹©ä¼˜èŠ‚ç‚¹","ğŸ‡¸ğŸ‡¬ - æ‹©ä¼˜èŠ‚ç‚¹"], icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/auto.png"}

  # åº”ç”¨åˆ†ç»„
  - {name: "ğŸ§© AI  æœåŠ¡", <<: *app,  icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/openai.png"}
  - {name: "â˜ï¸ Onedrive", <<: *app,  icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/onedrive.png"}
  - {name: "â“‚ï¸ å¾®è½¯æœåŠ¡", <<: *app,  icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/microsoft.png"}
  - {name: "ğŸ è‹¹æœæœåŠ¡", <<: *app,  icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/apple.png"}
  - {name: "ğŸ® æ¸¸æˆæœåŠ¡", <<: *app,  icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/game.png"}
  - {name: "ğŸ“º è§†é¢‘è§„åˆ™", <<: *strm, icon: "https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/icons/netflix.png"}

  # è‡ªåŠ¨ä¼˜é€‰ï¼ˆåœ°åŒºï¼‰
  - {name: "ğŸ‡­ğŸ‡° - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *hk}
  - {name: "ğŸ‡¯ğŸ‡µ - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *jp}
  - {name: "ğŸ‡°ğŸ‡· - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *kr}
  - {name: "ğŸ‡¸ğŸ‡¬ - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *sg}
  - {name: "ğŸ‡ºğŸ‡¸ - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *us}
  - {name: "ğŸ‡¬ğŸ‡§ - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *uk}
  - {name: "ğŸ‡«ğŸ‡· - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *fr}
  - {name: "ğŸ‡©ğŸ‡ª - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *de}
  - {name: "ğŸ‡¹ğŸ‡¼ - æ‹©ä¼˜èŠ‚ç‚¹", <<: *test, filter: *tw}

  # è‡ªåŠ¨å›é€€ï¼ˆåœ°åŒºï¼‰
  - {name: "ğŸ‡­ğŸ‡° - è‡ªåŠ¨å›é€€", <<: *fall, filter: *hk}
  - {name: "ğŸ‡¯ğŸ‡µ - è‡ªåŠ¨å›é€€", <<: *fall, filter: *jp}
  - {name: "ğŸ‡°ğŸ‡· - è‡ªåŠ¨å›é€€", <<: *fall, filter: *kr}
  - {name: "ğŸ‡¸ğŸ‡¬ - è‡ªåŠ¨å›é€€", <<: *fall, filter: *sg}
  - {name: "ğŸ‡ºğŸ‡¸ - è‡ªåŠ¨å›é€€", <<: *fall, filter: *us}
  - {name: "ğŸ‡¬ğŸ‡§ - è‡ªåŠ¨å›é€€", <<: *fall, filter: *uk}
  - {name: "ğŸ‡«ğŸ‡· - è‡ªåŠ¨å›é€€", <<: *fall, filter: *fr}
  - {name: "ğŸ‡©ğŸ‡ª - è‡ªåŠ¨å›é€€", <<: *fall, filter: *de}
  - {name: "ğŸ‡¹ğŸ‡¼ - è‡ªåŠ¨å›é€€", <<: *fall, filter: *tw}


# =========================== è§„åˆ™é›† ===========================
cls: &cls {type: http, behavior: classical, interval: 43200, format: text, proxy: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"}
dom: &dom {type: http, behavior: domain,    interval: 43200, format: text, proxy: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"}

rule-providers:
  FuckAD:               {<<: *dom, format: yaml, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/yaml/fuckAds.yaml,     path: ./rules/yaml/fuckAds.yaml}
  Game:                 {<<: *cls, format: yaml, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/yaml/Game.yaml,        path: ./rules/yaml/Game.yaml}
  sniff_skip:           {<<: *dom, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/domainset/sniff-skip.list,           path: ./rules/domainset/sniff-skip.list}
  fake_ip:              {<<: *dom, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/domainset/fake_ip.list,              path: ./rules/domainset/fake_ip.list}
  cdn_domainset:        {<<: *dom, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/domainset/cdn.txt,                   path: ./rules/domainset/cdn.txt}
  cdn_non_ip:           {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/cdn.txt,                      path: ./rules/non_ip/cdn.txt}
  stream_non_ip:        {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/stream.txt,                   path: ./rules/non_ip/stream.txt}
  stream_ip:            {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/ip/stream.txt,                       path: ./rules/ip/stream.txt}
  ai_non_ip:            {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/ai.txt,                       path: ./rules/non_ip/ai.txt}
  telegram_ip:          {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/ip/telegram.txt,                     path: ./rules/ip/telegram.txt}
  apple_cdn:            {<<: *dom, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/domainset/apple_cdn.txt,             path: ./rules/domainset/apple_cdn.txt}
  apple_services:       {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/apple_services.txt,           path: ./rules/non_ip/apple_services.txt}
  apple_cn_non_ip:      {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/apple_cn.txt,                 path: ./rules/non_ip/apple_cn.txt}
  microsoft_cdn_non_ip: {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/microsoft_cdn.txt,            path: ./rules/non_ip/microsoft_cdn.txt}
  microsoft_non_ip:     {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/microsoft.txt,                path: ./rules/non_ip/microsoft.txt}
  download_domainset:   {<<: *dom, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/domainset/download.txt,              path: ./rules/domainset/download.txt}
  download_non_ip:      {<<: *cls, url: https://cdn.jsdelivr.net/gh/baiye1997/baiye-mihomo-rules@main/rules/non_ip/download.txt,                 path: ./rules/non_ip/download.txt}


# =========================== åˆ†æµè§„åˆ™ ==========================
rules:
  # é IP ç±»
  - GEOSITE,private,DIRECT
  - RULE-SET,FuckAD,REJECT
  - DOMAIN-SUFFIX,bing.com,DIRECT
  - DOMAIN-SUFFIX,oaiusercontent.com,ğŸ§© AI  æœåŠ¡
  - DOMAIN-SUFFIX,oaistatic.com,ğŸ§© AI  æœåŠ¡
  - RULE-SET,cdn_domainset,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,cdn_non_ip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,stream_non_ip,ğŸ“º è§†é¢‘è§„åˆ™
  - RULE-SET,ai_non_ip,ğŸ§© AI  æœåŠ¡
  - GEOSITE,category-games@cn,DIRECT
  - RULE-SET,Game,ğŸ® æ¸¸æˆæœåŠ¡
  - GEOSITE,google-cn,DIRECT
  - RULE-SET,apple_cdn,DIRECT
  - RULE-SET,apple_cn_non_ip,DIRECT
  - RULE-SET,apple_services,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,microsoft_cdn_non_ip,DIRECT
  - GEOSITE,onedrive,â˜ï¸ Onedrive
  - RULE-SET,microsoft_non_ip,â“‚ï¸ å¾®è½¯æœåŠ¡
  - RULE-SET,download_domainset,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,download_non_ip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,cn,DIRECT
  - GEOSITE,gfw,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # IP ç±»
  - GEOIP,private,DIRECT,no-resolve
  - RULE-SET,stream_ip,ğŸ“º è§†é¢‘è§„åˆ™,no-resolve
  - RULE-SET,telegram_ip,ğŸš€ èŠ‚ç‚¹é€‰æ‹©,no-resolve
  - GEOIP,cn,DIRECT,no-resolve

  # å…œåº•
  - MATCH,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
